{"ast":null,"code":"import React from\"react\";import{ActionTypes}from\"../types/highlightTypes\";import{Streamlit}from\"streamlit-component-lib\";// Define the initial state of the component\nimport{jsx as _jsx}from\"react/jsx-runtime\";export const initialState={text:\"\",actual_text:[],highlights:[],nhighlights:[],selectedReference:\"P0\"};// Reducer function to handle state transitions\nexport const reducer=(state,action)=>{switch(action.type){case ActionTypes.SET_TEXT_HIGHLIGHTS:// Set the text andhighlight\nStreamlit.setComponentValue(action.payload.highlights);Streamlit.setComponentValue(action.payload.nhighlights);return{...state,text:action.payload.text,highlights:action.payload.highlights,nhighlights:action.payload.nhighlights};case ActionTypes.RENDER_TEXT:// Logic to render text withhighlight\nconst{text,highlights,nhighlights}=state;const actual_text=[];let start=0;let selectedReference=state.selectedReference;let label=selectedReference.charAt(0);let index=Number(selectedReference.slice(1));if(label===\"N\"){if(!nhighlights[index]){index=0;selectedReference=\"N0\";if(!nhighlights[index]){nhighlights[index]=[];}}}else{if(!highlights[index]){index=0;selectedReference=\"P0\";if(!highlights[index]){highlights[index]=[];}}}if(label==\"N\"){var _nhighlights$index;(_nhighlights$index=nhighlights[index])===null||_nhighlights$index===void 0?void 0:_nhighlights$index.sort((a,b)=>a.start-b.start).forEach((highlight,index)=>{actual_text.push(/*#__PURE__*/_jsx(\"span\",{children:text.substring(start,highlight.start)},`unhighlighted-${index}`));actual_text.push(/*#__PURE__*/_jsx(\"span\",{className:\"nhighlighted border border-primary bg-primary/20\",children:text.substring(highlight.start,highlight.end)},`nhighlighted-${index}`));start=highlight.end;});}else{var _highlights$index;(_highlights$index=highlights[index])===null||_highlights$index===void 0?void 0:_highlights$index.sort((a,b)=>a.start-b.start).forEach((highlight,index)=>{actual_text.push(/*#__PURE__*/_jsx(\"span\",{children:text.substring(start,highlight.start)},`unhighlighted-${index}`));actual_text.push(/*#__PURE__*/_jsx(\"span\",{className:\"highlighted border border-primary bg-primary/20\",children:text.substring(highlight.start,highlight.end)},`highlighted-${index}`));start=highlight.end;});}actual_text.push(/*#__PURE__*/_jsx(\"span\",{children:text.substring(start)},\"highlighted-end\"));Streamlit.setComponentValue(highlights);Streamlit.setComponentValue(nhighlights);return{...state,actual_text,selectedReference};case ActionTypes.ADD_REFERENCE:// Add a new reference\nlet add_label=action.payload;const newHighlights=[...state.highlights];const newNHighlights=[...state.nhighlights];newIndex=\"P\"+newHighlights.length;if(add_label===\"N\"){newIndex=\"N\"+newNHighlights.length;newNHighlights.push([]);}else{newHighlights.push([]);}return{...state,highlights:newHighlights,nhighlights:newNHighlights,selectedReference:newIndex};case ActionTypes.SELECT_REFERENCE:return{...state,selectedReference:action.payload};case ActionTypes.REMOVE_REFERENCE:const rem_label=action.payload[0];const rem_index=action.payload[1];if(rem_label===\"N\"){const updatedNHighlights=[...state.nhighlights];updatedHighlights.splice(rem_index,1);return{...state,highlights:[...state.highlights],nhighlights:updatedNHighlights,selectedReference:\"N\"+0};}else{const updatedHighlights=[...state.highlights];updatedNHighlights.splice(rem_index,1);return{...state,highlights:updatedHighlights,nhighlights:[...state.nhighlights],selectedReference:\"P\"+0};}default:return state;}};","map":{"version":3,"names":["React","ActionTypes","Streamlit","jsx","_jsx","initialState","text","actual_text","highlights","nhighlights","selectedReference","reducer","state","action","type","SET_TEXT_HIGHLIGHTS","setComponentValue","payload","RENDER_TEXT","start","label","charAt","index","Number","slice","_nhighlights$index","sort","a","b","forEach","highlight","push","children","substring","className","end","_highlights$index","ADD_REFERENCE","add_label","newHighlights","newNHighlights","newIndex","length","SELECT_REFERENCE","REMOVE_REFERENCE","rem_label","rem_index","updatedNHighlights","updatedHighlights","splice"],"sources":["/mnt/c/Users/ndeas/Desktop/Columbia/Research/Diverse Perspective Summarization/improving_coverage/perspective_summarization_streamlit/utils/highlighter/frontend/src/reducers/highlightReducer.tsx"],"sourcesContent":["import React from \"react\"\nimport { IState, IAction, ActionTypes } from \"../types/highlightTypes\"\nimport { Streamlit } from \"streamlit-component-lib\"\n\n// Define the initial state of the component\nexport const initialState: IState = {\n  text: \"\",\n  actual_text: [],\n  highlights: [],\n  nhighlights: [],\n  selectedReference: \"P0\",\n}\n\n// Reducer function to handle state transitions\nexport const reducer = (state: IState, action: IAction): IState => {\n  switch (action.type) {\n    case ActionTypes.SET_TEXT_HIGHLIGHTS:\n      // Set the text andhighlight\n      Streamlit.setComponentValue(action.payload.highlights)\n      Streamlit.setComponentValue(action.payload.nhighlights)\n      return {\n        ...state,\n        text: action.payload.text,\n        highlights: action.payload.highlights,\n        nhighlights: action.payload.nhighlights,\n      }\n\n    case ActionTypes.RENDER_TEXT:\n      // Logic to render text withhighlight\n      const { text, highlights, nhighlights } = state\n      const actual_text: JSX.Element[] = []\n      let start = 0\n      let selectedReference = state.selectedReference\n      let label = selectedReference.charAt(0)\n      let index = Number(selectedReference.slice(1))\n\n      if (label === \"N\") {\n        if (!nhighlights[index]) {\n          index = 0\n          selectedReference = \"N0\"\n          if (!nhighlights[index]) {\n            nhighlights[index] = []\n          }\n        }\n      } else {\n        if (!highlights[index]) {\n          index = 0\n          selectedReference = \"P0\"\n          if (!highlights[index]) {\n            highlights[index] = []\n          }\n        }\n      }\n\n\n\n      if (label == \"N\") {\n        nhighlights[index]\n          ?.sort((a, b) => a.start - b.start)\n          .forEach((highlight, index) => {\n            actual_text.push(\n              <span key={`unhighlighted-${index}`}>\n                {text.substring(start, highlight.start)}\n              </span>\n            )\n            actual_text.push(\n              <span\n                key={`nhighlighted-${index}`}\n                className=\"nhighlighted border border-primary bg-primary/20\"\n              >\n                {text.substring(highlight.start, highlight.end)}\n              </span>\n            )\n            start = highlight.end\n          })\n        } else {\n          highlights[index]\n          ?.sort((a, b) => a.start - b.start)\n          .forEach((highlight, index) => {\n            actual_text.push(\n              <span key={`unhighlighted-${index}`}>\n                {text.substring(start, highlight.start)}\n              </span>\n            )\n            actual_text.push(\n              <span\n                key={`highlighted-${index}`}\n                className=\"highlighted border border-primary bg-primary/20\"\n              >\n                {text.substring(highlight.start, highlight.end)}\n              </span>\n            )\n            start = highlight.end\n          })\n        }\n\n      actual_text.push(\n        <span key=\"highlighted-end\">{text.substring(start)}</span>\n      )\n\n      Streamlit.setComponentValue(highlights)\n      Streamlit.setComponentValue(nhighlights)\n      return {\n        ...state,\n        actual_text,\n        selectedReference,\n      }\n\n    case ActionTypes.ADD_REFERENCE:\n      // Add a new reference\n      let add_label = action.payload\n      const newHighlights = [...state.highlights]\n      const newNHighlights = [...state.nhighlights]\n      \n      newIndex = \"P\" + newHighlights.length\n      if (add_label === \"N\") {\n        newIndex = \"N\" + newNHighlights.length\n        newNHighlights.push([])\n      } else {\n        newHighlights.push([])\n      }\n\n      return {\n        ...state,\n        highlights: newHighlights,\n        nhighlights: newNHighlights,\n        selectedReference: newIndex,\n      }\n\n    case ActionTypes.SELECT_REFERENCE:\n      return {\n        ...state,\n        selectedReference: action.payload,\n      }\n\n    case ActionTypes.REMOVE_REFERENCE:\n      const rem_label = action.payload[0]\n      const rem_index = action.payload[1]\n      if (rem_label === \"N\") {\n        const updatedNHighlights = [...state.nhighlights]\n        updatedHighlights.splice(rem_index, 1)\n        return {\n          ...state,\n          highlights: [...state.highlights],\n          nhighlights: updatedNHighlights,\n          selectedReference: \"N\" + 0,\n        }\n      } else {\n        const updatedHighlights = [...state.highlights]\n        updatedNHighlights.splice(rem_index, 1)\n        return {\n          ...state,\n          highlights: updatedHighlights,\n          nhighlights: [...state.nhighlights],\n          selectedReference: \"P\" + 0,\n        }\n      }\n\n    default:\n      return state\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}